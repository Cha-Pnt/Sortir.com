{% extends 'base.html.twig' %}


{% block title %} Accueil | Sortir.com {% endblock %}
{% block stylesheet %} {{ parent() }}{%endblock %}
{% block head %}
    <link rel="stylesheet" href="{{ asset('css/accueil.css') }}">{% endblock %}

{% block body %}
    <div class="date-nom">
        <p>Date du jour : {{ 'now' |date('d/m/Y') }}<br>
        Utilisateur : {{ app.user.pseudo }}</p>
    </div>

    <div class="container">
        <h2>Filtrer les sorties</h2><br><br>

        {{ form_start(filtresForm) }}
        <div class="row">

            <div class="col-sm-6">
                <div class="row">
                    <div class="col-sm-3">
                        {{ form_label(filtresForm.campus) }}
                    </div>
                    <div class="col-sm-9">
                        {{ form_widget(filtresForm.campus) }}
                    </div>
                    <br><br>

                    <div class="col-sm-3">
                        {{ form_label(filtresForm.search) }}
                    </div>
                    <div class="col-sm-9">
                        {{ form_widget(filtresForm.search) }}
                    </div>
                    <br><br>

                    <div class="col-sm-3">
                        {{ form_label(filtresForm.dateDebut) }}
                    </div>
                    <div class="col-sm-9">
                        {{ form_widget(filtresForm.dateDebut) }}
                    </div>
                    <br><br>

                    <div class="col-sm-3">
                        {{ form_label(filtresForm.dateLimite) }}
                    </div>
                    <div class="col-sm-9">
                        {{ form_widget(filtresForm.dateLimite) }}
                    </div>
                </div>

            </div>

            <div class="col-sm-6">
                <div>
                    {{ form_label(filtresForm.organisateur) }}
                    {{ form_widget(filtresForm.organisateur) }}
                </div>
                <br>

                <div>
                    {{ form_label(filtresForm.inscription) }}
                    {{ form_widget(filtresForm.inscription) }}
                </div>
                <br>

                <div>
                    {{ form_label(filtresForm.etat) }}
                    {{ form_widget(filtresForm.etat) }}
                </div>
            </div>

        </div>
        <div class="button_side">
            <button type="submit" class="btn btn-primary btn-lg">Rechercher</button>
            <a href="{{ path('accueil') }}"><button type="button"  class="btn btn-primary btn-lg">Réinitialiser</button></a>
        </div>
        {{ form_end(filtresForm) }}
    </div>



    <table class="table">
        <thead class="thead-dark">

        <tr>
            <th scope="col">Nom de la sortie</th>
            <th scope="col">Date de la sortie</th>
            <th scope="col">Clôture</th>
            <th scope="col">Inscrits/places</th>
            <th scope="col">Etat</th>
            <th scope="col">Inscrit</th>
            <th scope="col">Organisateur</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for sortie in listeSorties %}
            <tr>
                <th scope="row">{{ sortie.nom }}</th>
                <td>{{ sortie.dateHeureDebut|date('d-m-y h:h') }}</td>
                <td>{{ sortie.dateLimite|date('d-m-y h:m') }}</td>
                <td>{{ sortie.nbInscrits }}/{{ sortie.nbInscriptionsMax }}</td>
                <td>{{ sortie.etat }}</td>
                <td>{%  for inscription in sortie.inscriptions %}
                        {% if inscription.participant == app.user %} X {% endif %}
                    {% endfor%}</td>
                <td><a href="{{ path('afficherProfil', {'id':sortie.organisateur.id}) }}">{{ sortie.organisateur }}</a></td>
                <td>{% if sortie.organisateur != app.user%}
                            {% if sortie.id in listeInscriptions %}
                                <a href="{{ path('afficherSortie',{'id':sortie.id}) }}">Afficher</a> -
                                {% if sortie.etat.libelle != 'Passée' and sortie.nbInscrits < sortie.nbInscriptionsMax %}
                                <a href="{{ path('desister',{'id':sortie.id}) }}">Se désister</a>
                                {% endif %}
                            {% else %}
                                <a href="{{ path('afficherSortie',{'id':sortie.id}) }}">Afficher</a> -
                                {% if sortie.etat.libelle != 'Passée' and sortie.nbInscrits< sortie.nbInscriptionsMax  %}
                                    <a href="{{ path('sinscrire',{'id':sortie.id}) }}">S'inscrire</a>
                                {% endif %}
                            {% endif %}
                    {% elseif sortie.etat.libelle == "Passée"%}
                        <a href="{{ path('afficherSortie',{'id':sortie.id}) }}">Afficher</a>
                        {% else %}
                            <a href="{{ path('modifierSortie',{'id':sortie.id}) }}">Modifier</a> -
                            {% if sortie.etat.libelle != "Annulée" %}
                            <a href="{{ path('annulation_sortie', {'id':sortie.id}) }}">Supprimer</a>
                            {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="create">

        <a class="btn btn-primary" href="{{ path('create_sortie')}}">Créer une sortie</a>

    </div>
{% endblock %}
